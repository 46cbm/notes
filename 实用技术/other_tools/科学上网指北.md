# 科学上网指北

## step1

购买没被墙的服务器，然后ssh连上服务器。系统推荐ubuntun18.04 64位。

## step2 安装ss并写配置

- 安装pip和几个依赖包

```
apt install -y python-pip python-gevent python-m2crypto
pip install --upgrade setuptools
```

如果pip报错`locale.Error: unsupported locale setting`，执行下面的命令

```
export LC_ALL="en_US.UTF-8"
export LC_CTYPE="en_US.UTF-8"
sudo dpkg-reconfigure locales
```

- 安装ss

```
pip install shadowsocks
```

- 创建配置文件

```
mkdir /etc/shadowsocks
vim /etc/shadowsocks/config.json
```

内容如下

```
{
    "server":"0.0.0.0",
    "server_port":80,
    "password":"password",
    "timeout":600,
    "method":"aes-256-cfb",
    "fast_open": false
}
```

如果要开多个端口，可以这样写

```
{
    "server":"0.0.0.0",
    "port_password": {
        "8888": "z13547842355",
        "8889": "z13547842355",
        "80": "z13547842355"
    },
    "timeout":600,
    "method":"aes-256-cfb",
    "fast_open": false
}
```

## step 2.1

由于Ubuntu18.04中openssl升级到1.1.0版本了，所以启动Shadowsocks的时候应该会报undefined symbol: EVP_CIPHER_CTX_cleanup错误。解决方法

1. 打开openssl.py

```
vim /usr/local/lib/python2.7/dist-packages/shadowsocks/crypto/openssl.py
```

2. 替换文中libcrypto.EVP_CIPHER_CTX_cleanup 为libcrypto.EVP_CIPHER_CTX_reset 共两处大概是52行和111行位置，并保存

## step3 启动ss

启动命令

```
ssserver -c /etc/shadowsocks/config.json -d start
```

如果要停止，用命令

```
ssserver -c /etc/shadowsocks/config.json -d stop
```

## step4 设置ss开启自动启动

创建文件shadowsocks.service

```
vim /etc/systemd/system/shadowsocks.service
```

写入

```
[Unit]
Description=Shadowsocks
After=network.target

[Service]
Type=forking
PIDFile=/run/shadowsocks/server.pid
PermissionsStartOnly=true
ExecStartPre=/bin/mkdir -p /run/shadowsocks
ExecStartPre=/bin/chown root:root /run/shadowsocks
ExecStart=/usr/local/bin/ssserver --pid-file /var/run/shadowsocks/server.pid -c /etc/shadowsocks/config.json -d start
Restart=on-abort
User=root
Group=root
UMask=0027

[Install]
WantedBy=multi-user.target
```

设置文件权限

```
chmod 755 /etc/systemd/system/shadowsocks.service
```

启动服务

```
systemctl start shadowsocks
systemctl enable shadowsocks
```



bash <(curl -L -s https://install.direct/go.sh)

```
{
  "inbounds": [{
    "port": 31425,
    "protocol": "vmess",
    "settings": {
      "clients": [
        {
          "id": "d9b43012-7e25-458c-9606-988d9fd2b428",
          "level": 1,
          "alterId": 64
        }
      ]
    }
  }],
  "outbounds": [{
    "protocol": "freedom",
    "settings": {}
  },{
    "protocol": "blackhole",
    "settings": {},
    "tag": "blocked"
  }],
  "routing": {
    "rules": [
      {
        "type": "field",
        "ip": ["geoip:private"],
        "outboundTag": "blocked"
      }
    ]
  }
}
```

# firewalld放行端口（适用于CentOS7/8）
firewall-cmd --permanent --add-port=31425/tcp # 31425改成你配置文件中的端口号
firewall-cmd --reload
# ufw放行端口（适用于ubuntu）
ufw allow 31425/tcp # 31425改成你的端口号
# iptables 放行端口（适用于CentOS 6/7）
iptables -I INPUT -p tcp --dport 31425 -j ACCEPT
# 设置开机启动
systemctl enable v2ray
# 运行v2ray
systemctl start v2ray


ss -ntlp | grep v2ray 命令可以查看v2ray是否正在运行。如果输出为空，大概率是被selinux限制了，解决办法如下：

1. 禁用selinux：setenforce 0;
2. 重启v2ray：systemctl restart v2ray

v2ray配置信息：               
 IP(address):  104.168.155.215
 端口(port)：12345
 id(uuid)：d9b43012-7e25-458c-9606-988d9fd2b428
 额外id(alterid)： 67
 加密方式(security)： auto
 传输协议(network)： tcp