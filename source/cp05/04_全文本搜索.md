# 4 全文本搜索

## 4.1 概述

并非所有引擎都支持全文本搜索，MyISAM支持，InnoDB不支持。

在创建表时，可以使用FULLTEXT来指明那些列支持全文本搜索。mysql会对指定的列进行索引。之后mysql自动维护改索引，在增加、更新或删除时，索引也会随之更新。

```sql
CREATE TABLE `productnotes` (
  `note_id` int(11) NOT NULL AUTO_INCREMENT,
  `prod_id` char(10) NOT NULL,
  `note_date` datetime NOT NULL,
  `note_text` text,
  PRIMARY KEY (`note_id`),
  FULLTEXT (`note_text`)
) ENGINE=MyISAM AUTO_INCREMENT=115 DEFAULT CHARSET=latin1
```

注意不要在导入数据时启动FULLTEXT索引。应当先导入数据，在修改表的定义来启用。这样有助于更快的导入数据。

## 4.2 进行全文本搜索

Match指定被搜索的列，Against指定要使用的搜索表达式。注意搜索不区分大小写。

```sql
mysql> SELECT note_text
    -> FROM productnotes
    -> WHERE Match(note_text) Against('rabbit');
+----------------------------------------------------------------------------------------------------------------------+
| note_text                                                                                                            |
+----------------------------------------------------------------------------------------------------------------------+
| Customer complaint: rabbit has been able to detect trap, food apparently less effective now.                         |
| Quantity varies, sold by the sack load.
All guaranteed to be bright and orange, and suitable for use as rabbit bait. |
+----------------------------------------------------------------------------------------------------------------------+
```

## 4.3 搜索结果的排序

搜索结果根据一个等级值来排序，值越大越排前面。Match和Against直接的结果就是这个值

```sql
SELECT note_text, Match(note_text) Against('rabbit') AS rank
FROM productnotes;
```

注意这里是在SELECT中使用，而不是WHERE中。可以看到不包含rabbit的列值是0。
