# 8 管理文件系统

## 8.1 探索linux文件系统

### 基本的linux文件系统

主要有：

- ext
- ext2

##### ext文件系统

扩展文件系统（extended filesystem）为linux提供了一个类unix的文件系统，使用虚拟目录来操作硬件设备，在物理设备上按定长的块来存储数据。

其采用索引节点来存放文件信息。每个物理设备中都有一个单独的索引节点表，每一个文件在索引节点表中都有一个条目。linux通过索引节点号来引用索引节点表中的每个索引节点。节点号是创建文件时系统分配的。

##### ext2文件系统

较之于ext，ext2扩大了文件大小的限制，扩展了索引节点表中关于文件的信息，还采用了按组分配块的方式减少碎片化。

ext中一个文件的块可能散布在整个硬盘中，这样查找文件会花费更多时间。而ext2把块又进行了分组，减少了查找时间。

但是ext2还有一个问题，就是如果文件和索引节点之间可能的不同步。

### 日志文件系统

主要有：

- ext3
- ext4
- Reiser
- JFS
- XFS

为了解决上述不同步问题，出现了日志文件系统（journal）：现将文件的更改写入日志，在数据成功写到存储设备和索引节点后，再将日志中的内容删除。有三种方式：

| 方法   | 描述                                         |
| :--- | :----------------------------------------- |
| 数据模式 | 索引节点和文件都会被写入日志；丢失风险低，但性能差                  |
| 有序模式 | 只有索引节点会被写入日志，但只有数据成功写入硬盘后，才会删除日志；trade off |
| 回写模式 | 只有索引节点会被写入日志，但不控制文件数据何时写入；风险较大，但还是比没有日志好   |

##### ext3

2001年引入linux内核，在etc2基础上增加了日志文件。默认采用有序模式：只将索引节点写入日志，知道数据块都被成功写入存储设备之后，才会删除。

##### ext4

目前使用最广泛，新增了块预分配等技术。

##### Reiser

采用回写模式，速度很快。

##### JFS

Journaled File System，IBM推出，采用有序模式。

##### XFS

硅图公司推出，采用回写模式。

### 写时复制（copy-on-write, COW）文件系统

主要有：

- ZFS
- Btrf

修改过的数据并不会直接覆盖当前数据，而是被放入文件系的其他地方。即使是数据修改已经完成，之前的数据也不会被重写。

##### ZFS

Sun公司推出，用于OpenSolaris，后移植linux。

##### Btrf文件系统

也称B树文件系统。

